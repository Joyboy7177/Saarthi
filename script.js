const translations = {
    en: {
        title: "Saarthi",
        emergencyTitle: "Emergency Numbers",
        trustedTitle: "Trusted Contact",
        saveContactBtn: "Save Contact",
        callBtn: "Call Trusted Contact",
        shareBtn: "Share Live Location via WhatsApp",
        smsShareBtn: "Share Location via SMS",
        emergencyNumbers: {
            "181": "Women Helpline (181)",
            "100": "Police (100)",
            "108": "Ambulance (108)",
            "1098": "Childline (1098)",
            "112": "Emergency (112)",
            "182": "Indian Railways Security Helpline (182)",
            "138": "Medical Assistance On Train (138)"
        },
        selfDefense: {
            title: "Self-Defense Techniques",
            palmStrike: {
                title: "Palm Strike",
                description: "Aim for the nose or chin."
            },
            elbowJab: {
                title: "Elbow Jab",
                description: "Target the attacker’s ribs or face."
            },
            kneeStrike: {
                title: "Knee Strike",
                description: "Strike the groin for maximum impact."
            }
        },
        safetyItems: {
            title: "Safety Items to Carry",
            pepperSpray: {
                title: "Pepper Spray",
                description: "Carry it in an easily accessible pocket."
            },
            safetyWhistle: {
                title: "Safety Whistle",
                description: "Use it to attract attention quickly."
            },
            keychainWeapon: {
                title: "Pocket Knife",
                description: "Hold it for quick use."
            }
        },
        generalTips: {
            title: "General Tips",
            tips: [
                "Be aware of your surroundings.",
                "Avoid poorly lit areas when alone.",
                "Inform a trusted contact about your location.",
                "Carry your phone and emergency contacts ready.",
                "Trust your instincts and act quickly if unsafe."
            ]
        }
    },
    hi: {
        title: "सारथी",
        emergencyTitle: "आपातकालीन नंबर",
        trustedTitle: "विश्वसनीय संपर्क",
        saveContactBtn: "संपर्क बचाएं",
        callBtn: "विश्वसनीय संपर्क को कॉल करें",
        shareBtn: "व्हाट्सएप के माध्यम से स्थान साझा करें",
        smsShareBtn: "एसएमएस के माध्यम से स्थान साझा करें",
        emergencyNumbers: {
            "181": "महिला हेल्पलाइन (181)",
            "100": "पुलिस (100)",
            "108": "एम्बुलेंस (108)",
            "1098": "चाइललाइन (1098)",
            "112": "आपातकाल (112)",
            "182": "रेल मदद सेवा (182)",
            "138": "रेल में चिकित्सा सहायता(138)"
        },
        selfDefense: {
            title: "स्वयं की रक्षा तकनीक",
            palmStrike: {
                title: "पाम स्ट्राइक",
                description: "नाक या ठोड़ी पर निशाना साधें।"
            },
            elbowJab: {
                title: "कोहनी का झटका",
                description: "हमलावर के पसलियों या चेहरे पर निशाना साधें।"
            },
            kneeStrike: {
                title: "घुटने की चोट",
                description: "अधिकतम प्रभाव के लिए गुप्तांग पर वार करें।"
            }
        },
        safetyItems: {
            title: "सुरक्षा आइटम ले जाने के लिए",
            pepperSpray: {
                title: "पेपर स्प्रे",
                description: "इसे आसानी से पहुंचने योग्य पॉकेट में रखें।"
            },
            safetyWhistle: {
                title: "सुरक्षा सीटी",
                description: "जल्दी से ध्यान आकर्षित करने के लिए इसका उपयोग करें।"
            },
            keychainWeapon: {
                title: "पॉकट चाकू",
                description: "इसे त्वरित उपयोग के लिए पकड़ें।"
            }
        },
        generalTips: {
            title: "सामान्य सुझाव",
            tips: [
                "अपने आस-पास के माहौल से अवगत रहें।",
                "अकेले होने पर कम रोशनी वाले स्थानों से बचें।",
                "अपने Trusted Contact को अपनी लोकेशन के बारे में सूचित करें।",
                "अपना फोन और आपातकालीन संपर्क तैयार रखें।",
                "अपने इन्स्टिंक्ट्स पर विश्वास करें और अगर असुरक्षित महसूस हो तो तुरंत कार्रवाई करें।"
            ]
        }
    },
    kn: {
        title: "ಸಾರಥಿ",
        emergencyTitle: "ಪದವಿಪರಿಶಿಷ್ಟ ಸಂಖ್ಯೆಗಳು",
        trustedTitle: "ನಂಬಿದ ಸಂಪರ್ಕ",
        saveContactBtn: "ಸಂಪರ್ಕವನ್ನು ಉಳಿಸಿ",
        callBtn: "ನಂಬಿದ ಸಂಪರ್ಕಕ್ಕೆ ಕರೆ ಮಾಡಿ",
        shareBtn: "WhatsApp ಮೂಲಕ ಸ್ಥಿತಿ ಹಂಚು",
        smsShareBtn: "SMS ಮೂಲಕ ಸ್ಥಿತಿ ಹಂಚು",
        emergencyNumbers: {
            "181": "ಹೆಣ್ಣು ಸಹಾಯವಾಣಿ (181)",
            "100": "ಪೊಲೀಸು (100)",
            "108": "ಆಂಬುಲೆನ್ಸ್ (108)",
            "1098": "ಚೈಲ್ಡ್‌ಲೈನ್ (1098)",
            "112": "ಪದವಿಪರಿಶಿಷ್ಟ (112)",
            "182": "ಭಾರತೀಯ ರೈಲ್ವೆ ಸಹಾಯವಾಣಿ (182)",
            "138": "ರೈಲಿನಲ್ಲಿ ವೈದ್ಯಕೀಯ ಸಹಾಯ (138)"
        },
        selfDefense: {
            title: "ಸ್ವಯಂ ರಕ್ಷಣೆ ತಂತ್ರಗಳು",
            palmStrike: {
                title: "ಹಸ್ತ ಬಾರಿಸು",
                description: "ನಾಕು ಅಥವಾ ಮೂಗು ಅನ್ನು ಗುರಿಯಾಗಿಸು."
            },
            elbowJab: {
                title: "ಕೋಹನಿಯ ಹೊಡೆತ",
                description: "ಆಕ್ರಮಣಕಾರಿಯ ಎಲುಬುಗಳು ಅಥವಾ ಮುಖವನ್ನು ಗುರಿಯಾಗಿಸು."
            },
            kneeStrike: {
                title: "ಮೂಟು ಹೊಡೆತ",
                description: "ಅತಿದೊಡ್ಡ ಪರಿಣಾಮಕ್ಕಾಗಿ ಗೋಪುಟು ಮೇಲೆ ಹೊಡೆತ ಮಾಡಿ."
            }
        },
        safetyItems: {
            title: "ನಿಮ್ಮೊಂದಿಗೆ ತೆಗೆದುಕೊಂಡು ಹೋಗುವ ಭದ್ರತಾ ವಸ್ತುಗಳು",
            pepperSpray: {
                title: "ಪೆಪ್ಪರ್ ಸ್ಪ್ರೇ",
                description: "ಅದನ್ನು ಸುಲಭವಾಗಿ ಪ್ರಾಪ್ತಿಗಾಗಿರುವ ಜೀನ್ಸ್‌ಗೆ ಇಡಿ."
            },
            safetyWhistle: {
                title: "ಭದ್ರತೆ ಸಿಟಿ",
                description: "ತಕ್ಷಣ ಗಮನವನ್ನು ಸೆಳೆಯಲು ಇದನ್ನು ಬಳಸಿ."
            },
            keychainWeapon: {
                title: "ಪಾಕೆಟ್ ಚಾಕು",
                description: "ಇದನ್ನು ತ್ವರಿತವಾಗಿ ಉಪಯೋಗಿಸಲು ಹಿಡಿಯಿರಿ."
            }
        },
        generalTips: {
            title: "ಸಾಮಾನ್ಯ ಸಲಹೆಗಳು",
            tips: [
                "ನಿಮ್ಮ ಸುತ್ತಲೂ ಇರುವ ಪರಿಸ್ಥಿತಿಯನ್ನು ಗಮನಿಸಿ.",
                "ಒಂಟಿಯಾಗಿರುವಾಗ ದುರ್ಬಲವಾಗಿ ಬೆಳಗುವ ಪ್ರದೇಶಗಳನ್ನು ತಪ್ಪಿಸಿ.",
                "ನಂಬಿದ ಸಂಪರ್ಕವನ್ನು ನಿಮ್ಮ ಸ್ಥಳಮಾನವನ್ನು ತಿಳಿಸಿ.",
                "ನಿಮ್ಮ ಫೋನ್ ಮತ್ತು ತುರ್ತು ಸಂಪರ್ಕಗಳನ್ನು ಸಿದ್ಧಪಡಿಸಿ.",
                "ನಿಮ್ಮ ದೃಷ್ಟಿಕೋನಗಳನ್ನು ನಂಬಿ, ಅಪಾಯಕರಾಗಿದ್ದರೆ ತಕ್ಷಣ ಕ್ರಿಯೆ ಮಾಡಿ."
            ]
        }
    }
};

document.getElementById('language-select').addEventListener('change', function () {
    const lang = this.value;
    updateLanguage(lang);
});

function updateLanguage(lang) {
    const selectedTranslations = translations[lang];
    document.getElementById('header-title').innerText = selectedTranslations.title;
    document.getElementById('emergency-title').innerText = selectedTranslations.emergencyTitle;
    document.getElementById('trusted-title').innerText = selectedTranslations.trustedTitle;
    document.getElementById('save-contact-btn').innerText = selectedTranslations.saveContactBtn;
    document.getElementById('trusted-call-btn').innerText = selectedTranslations.callBtn;
    document.getElementById('trusted-share-btn').innerText = selectedTranslations.shareBtn;
    document.getElementById('trusted-sms-share-btn').innerText = selectedTranslations.smsShareBtn;

    const emergencyNumbers = selectedTranslations.emergencyNumbers;
    document.getElementById('emergency-181').innerText = emergencyNumbers['181'];
    document.getElementById('emergency-100').innerText = emergencyNumbers['100'];
    document.getElementById('emergency-108').innerText = emergencyNumbers['108'];
    document.getElementById('emergency-1098').innerText = emergencyNumbers['1098'];
    document.getElementById('emergency-112').innerText = emergencyNumbers['112'];
    document.getElementById('emergency-182').innerText = emergencyNumbers['182'];
    document.getElementById('emergency-138').innerText = emergencyNumbers['138'];

    const selfDefense = selectedTranslations.selfDefense;
    document.getElementById('self-defense-title').innerText = selfDefense.title;
    document.querySelectorAll('.card')[0].querySelector('h3').innerText = selfDefense.palmStrike.title;
    document.querySelectorAll('.card')[0].querySelector('p').innerText = selfDefense.palmStrike.description;
    document.querySelectorAll('.card')[1].querySelector('h3').innerText = selfDefense.elbowJab.title;
    document.querySelectorAll('.card')[1].querySelector('p').innerText = selfDefense.elbowJab.description;
    document.querySelectorAll('.card')[2].querySelector('h3').innerText = selfDefense.kneeStrike.title;
    document.querySelectorAll('.card')[2].querySelector('p').innerText = selfDefense.kneeStrike.description;

    const safetyItems = selectedTranslations.safetyItems;
    document.getElementById('safety-items-title').innerText = safetyItems.title;
    document.querySelectorAll('.card')[3].querySelector('h3').innerText = safetyItems.pepperSpray.title;
    document.querySelectorAll('.card')[3].querySelector('p').innerText = safetyItems.pepperSpray.description;
    document.querySelectorAll('.card')[4].querySelector('h3').innerText = safetyItems.safetyWhistle.title;
    document.querySelectorAll('.card')[4].querySelector('p').innerText = safetyItems.safetyWhistle.description;
    document.querySelectorAll('.card')[5].querySelector('h3').innerText = safetyItems.keychainWeapon.title;
    document.querySelectorAll('.card')[5].querySelector('p').innerText = safetyItems.keychainWeapon.description;

    const generalTips = selectedTranslations.generalTips;
    document.getElementById('general-tips-title').innerText = generalTips.title;
    document.getElementById('tips-list').innerHTML = generalTips.tips.map(tip => `<li>${tip}</li>`).join('');
}

// Dark Mode Toggle
document.getElementById('theme-toggle').addEventListener('click', function () {
    document.body.classList.toggle('dark-mode');
});


// Trusted Contact
const saveContactBtn = document.getElementById('save-contact-btn');
const trustedCallBtn = document.getElementById('trusted-call-btn');
const trustedShareBtn = document.getElementById('trusted-share-btn');
const trustedSmsShareBtn = document.getElementById('trusted-sms-share-btn');
const contactDisplay = document.getElementById('contact-display');
const contactNameSpan = document.getElementById('contact-name');
const contactNumberSpan = document.getElementById('contact-number');

saveContactBtn.addEventListener('click', () => {
    const name = document.getElementById('trusted-name').value;
    const number = document.getElementById('trusted-number').value;
    const validIndianNumber = /^(\+91|91)?[6-9][0-9]{9}$/;

    if (name && number.match(validIndianNumber)) {
        const formattedNumber = number.startsWith('+91') ? number : `+91${number}`;
        localStorage.setItem('trustedName', name);
        localStorage.setItem('trustedNumber', formattedNumber);
        contactNameSpan.textContent = name;
        contactNumberSpan.textContent = formattedNumber;
        contactDisplay.classList.remove('hidden');
        trustedCallBtn.classList.remove('hidden');
        trustedShareBtn.classList.remove('hidden');
        trustedSmsShareBtn.classList.remove('hidden');
    } else {
        alert(translations[currentLang].errorMessage);
    }
});

// Preload saved contact on page load
window.addEventListener('load', () => {
    const savedName = localStorage.getItem('trustedName');
    const savedNumber = localStorage.getItem('trustedNumber');

    if (savedName && savedNumber) {
        contactNameSpan.textContent = savedName;
        contactNumberSpan.textContent = savedNumber;
        contactDisplay.classList.remove('hidden');
        trustedCallBtn.classList.remove('hidden');
        trustedShareBtn.classList.remove('hidden');
        trustedSmsShareBtn.classList.remove('hidden');
    }
});

// Call Trusted Contact
trustedCallBtn.addEventListener('click', () => {
    const number = localStorage.getItem('trustedNumber');
    if (number) {
        window.location.href = `tel:${number}`;
    } else {
        alert('No trusted contact saved.');
    }
});

// Share Live Location via WhatsApp
trustedShareBtn.addEventListener('click', () => {
    const number = localStorage.getItem('trustedNumber');
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            const { latitude, longitude } = position.coords;
            const locationLink = `https://maps.google.com/?q=${latitude},${longitude}`;
            const message = `Hi, I need help. Here's my live location: ${locationLink}`;
            if (number) {
                window.location.href = `https://wa.me/${number}?text=${encodeURIComponent(message)}`;
            } else {
                alert('No trusted contact saved.');
            }
        }, () => {
            alert('Unable to fetch location. Please check your permissions.');
        });
    } else {
        alert('Geolocation is not supported by your browser.');
    }
});

// Share Location via SMS
trustedSmsShareBtn.addEventListener('click', () => {
    const number = localStorage.getItem('trustedNumber');
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            const { latitude, longitude } = position.coords;
            const locationMessage = `Hi, I need help. Here's my location: https://maps.google.com/?q=${latitude},${longitude}`;
            if (number) {
                window.location.href = `sms:${number}?body=${encodeURIComponent(locationMessage)}`;
            } else {
                alert('No trusted contact saved.');
            }
        }, () => {
            alert('Unable to fetch location. Please check your permissions.');
        });
    } else {
        alert('Geolocation is not supported by your browser.');
    }
});

// Report an Issue: Send Email
const reportForm = document.getElementById('report-form');
const responseMessage = document.getElementById('response-message');

reportForm.addEventListener('submit', function (event) {
    event.preventDefault(); // Prevent the default form submission

    const issueDescription = document.getElementById('report-text').value;
    const emailAddress = 'gdd17171@gmail.com';
    const subject = 'Reported Issue from Safe Space App';
    const body = encodeURIComponent(issueDescription);

    // Open default email client
    window.location.href = `mailto:${emailAddress}?subject=${subject}&body=${body}`;

    // Show a response message
    responseMessage.classList.remove('hidden');
    setTimeout(() => {
        responseMessage.classList.add('hidden');
    }, 5000);
});
